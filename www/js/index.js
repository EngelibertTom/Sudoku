function J(b){function q(A){A.stopPropagation();const{offsetX:N,offsetY:X}=A,F=Math.min(Math.floor(N/b.ui.cellSize),8),Y=Math.min(Math.floor(X/b.ui.cellSize),8),h=b.getSelectedCell();if(h===null||h[0]!==F||h[1]!==Y)b.setSelectedCell([F,Y]),b.refreshGrid()}function B(A){if(A.stopPropagation(),b.getSelectedCell()!==null)b.setSelectedCell(null),b.refreshGrid()}function L(A){if(A.stopPropagation(),A.key>="1"&&A.key<="9"&&b.getSelectedCell()!==null)b.toggle(parseInt(A.key))}b.canvas.addEventListener("mousemove",q),b.canvas.addEventListener("mouseout",B),document.onkeyup=L}class Q{b;q;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(b){if(Q._uis.has(b))return Q._uis.get(b);const q=b.getContext("2d");if(q===null)return!1;const B=new Q(b,q);return Q._uis.set(b,B),B}_cellSize;constructor(b,q){this._canvas=b;this._ctx=q;this._cellSize=Math.round(Math.min(b.width,b.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=Q.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(b,q,B=this._cellSize,L=Q.thinLineColor,A){const N=b*B,X=q*B;if(A)this._ctx.fillStyle=A,this._ctx.fillRect(N+1,X+1,B-2,B-2);return this._ctx.strokeStyle=L,this._ctx.strokeRect(N,X,B,B),this}drawRow(b,q){for(let B=0;B<9;B++)this.drawCell(B,b,this._cellSize,Q.thinLineColor,q);return this}drawColumn(b,q){for(let B=0;B<9;B++)this.drawCell(b,B,this._cellSize,Q.thinLineColor,q);return this}drawGroup(b,q,B){this.drawCell(b,q,this._cellSize*3,Q.boldLineColor,B);for(let L=0;L<3;L++)for(let A=0;A<3;A++)this.drawCell(b*3+A,q*3+L,this._cellSize,Q.thinLineColor);return this}drawCellValue(b,q,B){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const L=b*this._cellSize+Math.floor(this._cellSize*0.5),A=q*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(B.toString(),L,A),this}drawCellDomain(b,q,B){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const L=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),A=Math.floor(L/3),N=Math.max(1,Math.floor(this._cellSize*0.1)),X=b*this._cellSize+N,F=q*this._cellSize+N;for(let Y=1;Y<=9;Y++){const h=B.includes(Y)?Y:null,T=(Y-1)%3,H=Math.floor((Y-1)/3),O=X+A*T,E=F+A*H;this._ctx.fillText(h!==null?h.toString():"",O,E)}return this}drawEmptyGrid(){this.clearCanvas();for(let b=0;b<3;b++)for(let q=0;q<3;q++)this.drawGroup(q,b);return this}colorizeSelectedStuff(b){if(b===null)return this;const q=[Math.floor(b[0]/3),Math.floor(b[1]/3)];return this.drawRow(b[1],Q.impactedColor).drawColumn(b[0],Q.impactedColor).drawGroup(q[0],q[1],Q.impactedColor).drawCell(b[0],b[1],this._cellSize,Q.thinLineColor,Q.selectedColor),this}}function y(){const b=new WebSocket(`ws://${location.host}`);b.onopen=()=>setInterval(()=>b.send("ping"),5000),b.onmessage=(q)=>{if(q.data!=="Well received")console.log(q.data);if(q.data==="reload")location.reload()}}var x=function(b){const q=document.getElementById(b);if(q===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const B=Q.get(q);if(!B)return!1;const L=[],A=[];for(let N=0;N<9;N++){L.push([]),A.push([]);for(let X=0;X<9;X++)L[N].push([1,2,3,4,5,6,7,8,9]),A[N].push(null)}return{canvas:q,ui:B,cellDomains:L,cellValues:A}},g=function(b){const{canvas:q,ui:B,cellDomains:L,cellValues:A}=b;let N=null;function X(E,K){if(A[K][E]!==null)B.drawCellValue(E,K,A[K][E]);else B.drawCellDomain(E,K,L[K][E])}function F(){for(let E=0;E<9;E++)for(let K=0;K<9;K++)X(K,E)}function Y(E,K,R){const W=L[K][E],Z=W.indexOf(R);if(Z!==-1)W.splice(Z,1)}function h(E,K,R){const W=L[K][E];if(!W.includes(R))W.push(R)}function T(E,K,R,W){const Z=W?Y:h;for(let $=0;$<9;$++){if($!==E)Z($,K,R);if($!==K)Z(E,$,R)}const G=Math.floor(E/3),f=Math.floor(K/3);for(let $=0;$<3;$++)for(let P=0;P<3;P++){const M=G*3+P,_=f*3+$;if(M!==E&&_!==K)Z(M,_,R)}}function H(E){const K=N[0],R=N[1];if(A[R][K]===null){if(L[R][K].includes(E))A[R][K]=E,T(K,R,E,!0),O()}else if(A[R][K]===E){A[R][K]=null,T(K,R,E,!1);for(let W=0;W<9;W++)for(let Z=0;Z<9;Z++)if(A[W][Z]===E)T(Z,W,E,!0);O()}}function O(){B.drawEmptyGrid().colorizeSelectedStuff(N),F()}J({canvas:q,ui:B,refreshGrid:O,toggle:H,getSelectedCell:()=>N,setSelectedCell:(E)=>N=E}),y(),O()},w=x("sudokuCanvas");if(w)g(w);
